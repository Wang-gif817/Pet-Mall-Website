<!-- 首页 -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>首页</title>
    <link rel="stylesheet" href="./layui/css/layui.css">
    <link rel="stylesheet" href="./xznstatic/css/common.css"/>
    <link rel="stylesheet" href="./xznstatic/css/style.css"/>

    <link rel="stylesheet" href="css/theme.css"/>
</head>
<style type="text/css">
    html, body {
        height: 100%;
    }
</style>
<body>


<!-- start 顶部导航栏1 -->
		<div id="header">
            <div v-if='true' class="nav-top">
                <img v-if='false' class="nav-top-img" src=''>
                <div v-if="true" class="nav-top-title">{{projectName}}</div>
                <div class="nav-top-tel">欢迎来到宠物商城，为您的爱宠提供优质商品</div>
            </div>
            <div class="navs">
                <!-- <div class="logo" style="font-size: 20px;top: 32px;color: #fff;font-weight: bold;margin-left: -200px;width: 240px;" v-text="projectName"></div> -->
                <div class="title" v-if="false" v-text="projectName"></div>
                <div class="list">
                    <ul>
                        <li class='current'><a href="javascript:navPage('./pages/home/home.html')" class="menumain"><i class="layui-icon layui-icon-home"></i>首页</a></li>
                        <li v-for="(item,index) in indexNav" v-bind:key="index"><a :href="'javascript:navPage(\''+item.url+'\')'" class="menumain" style="cursor: pointer;"><i class="layui-icon" :class="iconArr[index]"></i>{{item.name}}</a></li>
                        <li><a href="javascript:centerPage();" class="menumain"><i class="layui-icon layui-icon-username"></i>个人中心</a></li>
                        <li><a :href="adminurl" target="_blank" class="menumain" style="cursor: pointer;"><i class="layui-icon layui-icon-link"></i>后台管理</a></li>
                        <li><a href="javascript:navPage('./pages/cart/list.html')" class="menumain"><i class="layui-icon">&#xe657;</i>购物车</a></li>
                    </ul>
                </div>
            </div>
        </div>


<iframe src="./pages/home/home.html" id="iframe" frameborder="0" scrolling="no" width="100%" onload="changeFrameHeight"></iframe>

<div id="tabbar" v-if="true" class="tabbar  main_color" :style='{"padding":"20px 0","boxShadow":"0 0 0px rgba(255,0,0,.8)","margin":"10px 0 0 0","borderColor":"rgba(0,0,0,.3)","borderRadius":"0","borderWidth":"0","borderStyle":"solid"}' style="position: relative;z-index: 999;">
    <div :style='{"padding":"0 10px","boxShadow":"0 0 0px rgba(255,0,0,.8)","margin":"10px auto","borderColor":"rgba(0,0,0,1)","backgroundColor":"#000","color":"#fff","textAlign":"center","borderRadius":"0","borderWidth":"0","width":"100%","lineHeight":"32px","fontSize":"14px","borderStyle":"solid"}' class="company"></div>
    <div :style='{"padding":"0 10px","boxShadow":"0 0 6px rgba(255,0,0,0)","margin":"10px auto","borderColor":"rgba(0,0,0,1)","backgroundColor":"#000","color":"#fff","textAlign":"center","borderRadius":"0","borderWidth":"0","width":"100%","lineHeight":"32px","fontSize":"14px","borderStyle":"solid"}' class="record"></div>
    <div :style='{"padding":"0 10px","boxShadow":"0 0 0px rgba(255,0,0,0)","margin":"10px auto 30px auto","borderColor":"rgba(255,255,255,1)","backgroundColor":"rgba(160, 67, 26, 1)","color":"#fff","textAlign":"center","borderRadius":"0","borderWidth":"0px 0","width":"40%","lineHeight":"32px","fontSize":"15px","borderStyle":"solid"}' class="desc"></div>
</div>

<script src="./xznstatic/js/jquery-1.11.3.min.js"></script>
<script src="./layui/layui.js"></script>
<script src="./js/vue.js"></script>
<!-- 引入element组件库 -->
<script src="xznstatic/js/element.min.js"></script>
<!-- 引入element样式 -->
<link rel="stylesheet" href="xznstatic/css/element.min.css">
<script src="./js/config.js"></script>

<script>
    var vue1 = new Vue({el: '#tabbar'})

    var vue = new Vue({
        el: '#header',
        data: {
            iconArr: ['layui-icon-gift','layui-icon-email','layui-icon-logout','layui-icon-transfer','layui-icon-slider','layui-icon-print','layui-icon-cols','layui-icon-snowflake','layui-icon-note','layui-icon-flag','layui-icon-theme','layui-icon-website','layui-icon-console','layui-icon-face-surprised','layui-icon-template-1','layui-icon-app','layui-icon-read','layui-icon-component','layui-icon-file-b','layui-icon-unlink','layui-icon-tabs','layui-icon-form','layui-icon-chat'],
            indexNav: indexNav,
            adminurl: adminurl,
            projectName: projectName,
        },
        mounted: function() {
            this.bindClickOnLi();
        },
        created() {
            this.iconArr.sort(()=>{
                return (0.5-Math.random())
        })
        },
        methods: {
            jump(url) {
                jump(url)
            },
            bindClickOnLi() {
                let list = document.getElementsByTagName("li");
                for(var i = 0;i<list.length;i++){
                    list[i].onclick = function(){
                        $(this).addClass("current").siblings().removeClass("current");
                    }
                }
            }
        }
    });

    layui.use(['element','layer'], function() {
        var element = layui.element;
        var layer = layui.layer;
    });

    function chatTap(){
        var userTable = localStorage.getItem('userTable');
        if (userTable) {
            layui.layer.open({
                type: 2,
                title: '客服',
                area: ['600px', '600px'],
                content: './pages/chat/list.html'
            });
        } else {
            window.location.href = './pages/login/login.html'
        }
    }

    // 导航栏跳转
    function navPage(url) {
        localStorage.setItem('iframeUrl', url);
        document.getElementById('iframe').src = url;
        // 同步更新导航标签高亮
        updateActiveTab(url);
    }

    // 根据URL更新导航标签高亮状态
    function updateActiveTab(url) {
        // 移除所有导航项的current类
        let navItems = document.querySelectorAll('#header .navs li');
        navItems.forEach(item => item.classList.remove('current'));

        console.log('更新导航高亮, URL:', url); // 调试日志

        // 根据URL匹配对应的导航项并添加current类
        if (url.includes('/home/home.html')) {
            // 首页
            console.log('匹配到首页');
            navItems[0].classList.add('current');
        } else if (url.includes('/baike/')) {
            // 百科相关页面（列表、详情等）
            console.log('匹配到百科页面');
            // indexNav中第一个是百科信息，所以是navItems[1]
            if (navItems[1]) {
                navItems[1].classList.add('current');
            }
        } else if (url.includes('/forum/')) {
            // 论坛相关页面
            console.log('匹配到论坛页面');
            // indexNav中第二个是论坛，所以是navItems[2]
            if (navItems[2]) {
                navItems[2].classList.add('current');
            }
        } else if (url.includes('/liuyan/')) {
            // 留言版相关页面
            console.log('匹配到留言版页面');
            // indexNav中第三个是留言版，所以是navItems[3]
            if (navItems[3]) {
                navItems[3].classList.add('current');
            }
        } else if (url.includes('/shangpin/')) {
            // 商品相关页面（列表、详情等）
            console.log('匹配到商品页面');
            // indexNav中第四个是商品，所以是navItems[4]
            if (navItems[4]) {
                navItems[4].classList.add('current');
            }
        } else if (url.includes('/center.html')) {
            // 个人中心
            console.log('匹配到个人中心');
            // 个人中心是第5个导航项（0-based index = 5）
            if (navItems[5]) {
                navItems[5].classList.add('current');
            }
        } else if (url.includes('/cart/')) {
            // 购物车
            console.log('匹配到购物车');
            // 购物车是最后一个导航项
            if (navItems[navItems.length - 1]) {
                navItems[navItems.length - 1].classList.add('current');
            }
        }
    }

    // 跳转到个人中心也
    function centerPage() {
        var userTable = localStorage.getItem('userTable');
        if (userTable) {
            var centerUrl = './pages/' + userTable + '/center.html';
            localStorage.setItem('iframeUrl', centerUrl);
            document.getElementById('iframe').src = centerUrl;
            // 同步更新导航标签高亮
            updateActiveTab(centerUrl);
        } else {
            window.location.href = './pages/login/login.html'
        }
    }

    var iframeUrl = localStorage.getItem('iframeUrl') || './pages/home/home.html';
    document.getElementById('iframe').src = iframeUrl;
    // 初始化时也更新导航标签高亮
    updateActiveTab(iframeUrl);

    // 监听iframe的load事件，当iframe内容变化时同步更新导航栏
    document.getElementById('iframe').addEventListener('load', function() {
        try {
            // 尝试获取iframe的当前URL
            var iframe = document.getElementById('iframe');
            var iframeLocation = iframe.contentWindow.location.href;

            console.log('iframe加载完成，当前URL:', iframeLocation);

            // 从完整URL中提取相对路径
            var baseUrl = window.location.origin + window.location.pathname.replace('index.html', '');
            var relativePath = iframeLocation.replace(baseUrl, './');

            console.log('提取的相对路径:', relativePath);

            // 更新localStorage
            localStorage.setItem('iframeUrl', relativePath);

            // 更新导航栏高亮
            updateActiveTab(relativePath);
        } catch(e) {
            console.log('无法访问iframe URL（可能是跨域限制）:', e);
        }
    });

    // var i = 0;
    setInterval(function(){
        // i++;
        // if(i<50) changeFrameHeight();
        changeFrameHeight();
    },200)

    function changeFrameHeight() {
        var iframe = document.getElementById('iframe');
        // iframe.height = 'auto';
        if (iframe) {
            var iframeWin = iframe.contentWindow || iframe.contentDocument.parentWindow;
            if (iframeWin.document.body) {
                iframe.height = iframeWin.document.body.scrollHeight;
            }
        }
    };

    //  窗口变化时候iframe自适应
    // function changeFrameHeight() {
    // var header = document.getElementById('header').scrollHeight;
    //     let isshow = true
    //     var tabbar = 0
    //     if(isshow) {
    //       tabbar = document.getElementById('tabbar').scrollHeight
    //     }
    // var ifm = document.getElementById("iframe");
    // ifm.height = document.documentElement.clientHeight - header - tabbar;
    // ifm.width = document.documentElement.clientWidth;
    // }

    // reasize 事件 窗口大小变化后执行的方法
    window.onresize = function() {
        changeFrameHeight();
    }
</script>
</body>
</html>
